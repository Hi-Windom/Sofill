/*!
* sofill v1.0.7
* https://github.com/Hi-Windom/Sofill
* https://www.npmjs.com/package/sofill
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sofill={})}(this,(function(e){"use strict";var t={"通知":function(e,t=7e3){var n=new XMLHttpRequest;n.open("POST","http://127.0.0.1:6806/api/notification/pushMsg",!0),n.setRequestHeader("Content-type","application/json");var o={msg:e,timeout:7e3};n.send(JSON.stringify(o)),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var e=n.responseText;console.log(e)}}},pushMessage:function(e){var t=new XMLHttpRequest;t.open("POST","http://127.0.0.1:6806/api/notification/pushMsg",!0),t.setRequestHeader("Content-type","application/json");var n={msg:e,timeout:7e3};t.send(JSON.stringify(n)),t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){var e=t.responseText;console.log(e)}}}};var n={compareVersion:function(e,t){const n=e.split("."),o=t.split("."),a=n.length,r=o.length,i=Math.min(a,r);let c=0;for(;c<i;c++){let e=parseInt(n[c]),t=parseInt(o[c]);if(e>t)return 1;if(e<t)return-1}if(a>r){for(let e=c;e<a;e++)if(0!==parseInt(n[e]))return 1;return 0}if(a<r){for(let e=c;e<r;e++)if(0!==parseInt(o[e]))return-1;return 0}return 0},isEmpty:function(e){return null==e||""===e||"null"===e},RangeLimitedInt:function(e,t,n){var o=parseInt(e,10),a=parseInt(t,10),r=parseInt(n,10),i=a<r?a:r;return o>i?o:i},MoveDOM:function(e,t){var n=document.querySelector(e);document.querySelector(t).appendChild(n)},MoveChildren:function(e,t){for(var n=document.querySelector(e),o=n.children,a=n.childElementCount,r=document.querySelector(t),i=0;i<a;i++)r.appendChild(o[0])},CopyDOM:function(e,t){var n=document.querySelector(e),o=document.querySelector(t),a=n.cloneNode(!0);o.appendChild(a)},isAppMode:function(){return!document.getElementsByTagName("body")[0].classList.contains("android")&&(!document.getElementsByTagName("body")[0].classList.contains("body--desktop")&&("windows"===window.siyuan.config.system.os||"darwin"===window.siyuan.config.system.os))},removejscssfile:function(e,t){for(var n="js"===t?"script":"css"===t?"link":"none",o="js"===t?"src":"css"===t?"href":"none",a=document.getElementsByTagName(n),r=a.length;r>=0;r--)null!=a[r]?.getAttribute(o)&&-1!==a[r].getAttribute(o).indexOf(e)&&a[r].parentNode.removeChild(a[r])},AddEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},myRemoveEvent:function(e,t,n){e.addEventListener?e.removeEventListener(t,n,!1):e.attachEvent?e.detachEvent("on"+t,n):e["on"+t]=null},diguiTooONE:function(e,t){return null==e||null==t?null:function e(n){var o=n.children;if(o.length=0)return null;for(let n=0;n<o.length;n++){const r=o[n];if(t(r))return r;var a=e(r);if(null!=a)return a}return null}(e)}},o=Object.freeze({__proto__:null,Alert:t,Utils:n});async function a(e,t){let n=null;return await fetch(e,{body:JSON.stringify(t),method:"POST",headers:{Authorization:`Token '${window.siyuan.config.api.token}'`}}).then((function(e){n=e.json()})),console.log(n),n}async function r(e){let t=await e;return 0===t.code?t.data:null}var i={sql:c};async function c(e){return r(a("/api/query/sql",{stmt:e}))}var s={getBlockAttrs:async function(e){return r(a("/api/attr/getBlockAttrs",{id:e}))},setBlockAttrs:async function(e,t){return r(a("/api/attr/setBlockAttrs",{id:e,attrs:t}))},getBlockByID:async function(e){let t=`select * from blocks where id ='${e}'`;return(await c(t))[0]}};var l={getBlockKramdown:async function(e){return r(a("/api/block/getBlockKramdown",{id:e}))},getBlockBreadcrumb:async function(e){return r(a("/api/block/getBlockBreadcrumb",{id:e}))},insertBlock:async function(e,t,n){let o="/api/block/insertBlock";return r(a(o,n={previousID:e,dataType:t,data:n}))},prependBlock:async function(e,t,n){let o="/api/block/prependBlock";return r(a(o,n={parentID:e,dataType:t,data:n}))},appendBlock:async function(e,t,n){let o="/api/block/appendBlock";return r(a(o,n={parentID:e,dataType:t,data:n}))},deleteBlock:async function(e){return r(a("/api/block/deleteBlock",{id:e}))},updateBlock:async function(e,t,n){let o="/api/block/updateBlock";return r(a(o,n={id:e,dataType:t,data:n}))}};var u={exportMdContent:async function(e){return r(a("/api/export/exportMdContent",{id:e}))}};const p=document.getElementById("themeStyle"),f=new URL(p.href).pathname.replace("theme.css",""),d=`${window.siyuan.config.system.confDir}\\appearance\\themes\\Sofill-\\`,y=`${d}style-S2/`;var h="Sofill",m="winsay";switch(h=window.siyuan.config.appearance.mode?window.siyuan.config.appearance.themeDark:window.siyuan.config.appearance.themeLight){case"Sofill+":m="lanco";break;case"Sofill=":m="lili"}var k=(()=>{let e=new URL(window.location.href);switch(!0){case e.pathname.startsWith("/stage/build/app"):return"body--app";case e.pathname.startsWith("/stage/build/desktop"):return"body--desktop";case e.pathname.startsWith("/stage/build/mobile"):return"body--mobile";default:return null}})();document.body.classList.add(k),document.body.classList.add(window.theme.OS);var g={clientMode:k,Iterator2:function*(e){for(let t=0;;t=(t+1)%e.length)yield e[t]},Iterator:function*(e){for(let t=0;;t=(t+1)%e.length)yield e[t]},latest_DC_ID:"SC_winsay_cp_custom__DS",latest_LC_ID:"SC_winsay_cp_custom__LS",colors2:["root-D-BlackGoldBlue.css","root-D-InkGreenPurple.css"],colors:["root.css","root-L-Blue.css","root-L-Red.css","root-L-Pink.css","root-L-Green.css","root-L-Yellow.css"],IDs:{STYLE_COLOR:"custom-id-style-theme-color",BUTTON_TOOLBAR_CHANGE_COLOR:"custom-id-button-toolbar-change-color"},ID_COLOR_STYLE:"theme-color-style",THEME_ROOT:f,winsay_ROOT:"/appearance/themes/Sofill-/",winsay_ROOT_ABS:d,S2_BASE:"/appearance/themes/Sofill-/style-S2/",S2_BASE_ABS:y,themeStyle:p,config_UI:"/conf/appearance/themes/Sofill-/config/UI.json",config_Custom:"/conf/appearance/themes/Sofill-/config/Custom.json",ThemeName:h,AliaName:m,apitoken:window.siyuan.config.api.token},b={getFile:async function(e){const t=await fetch("/api/file/getFile",{method:"POST",headers:{Authorization:`Token ${g.apitoken}`},body:JSON.stringify({path:e})});return 200===t.status?t:null},putFile:async function(e,t,n=!1,o=Date.now()){let a=new Blob([t]),r=new File([a],e.split("/").pop()),i=new FormData;i.append("path",e),i.append("file",r),i.append("isDir",n.toString()),i.append("modTime",o.toString());const c=await fetch("/api/file/putFile",{body:i,method:"POST",headers:{Authorization:`Token ${g.apitoken}`}});return 200===c.status?await c.json():null}};var v={createDocWithMd:async function(e,t,n){return r(a("/api/filetree/createDocWithMd",{notebook:e,path:t,markdown:n}))},removeDoc:async function(e,t){return r(a("/api/filetree/removeDoc",{notebook:e,path:t}))},renameDoc:async function(e,t,n){return r(a("/api/filetree/renameDoc",{notebook:e,path:t,title:n}))},moveDoc:async function(e,t,n,o){return r(a("/api/filetree/moveDoc",{fromNotebook:e,fromPath:t,toNotebook:n,toPath:o}))},getHPathByPath:async function(e,t){return r(a("/api/filetree/getHPathByPath",{Notebook:e,Path:t}))},getHPathByID:async function(e){return r(a("/api/filetree/getHPathByID",{id:e}))},listDocsByPath:async function(e){return r(a("/api/filetree/listDocsByPath",{path:e}))},getDoc:async function(e){return r(a("/api/filetree/getDoc",{id:e,k:"",mode:2,size:36}))},searchDocs:async function(e){return r(a("/api/filetree/searchDocs",{k:e}))}};var w={getLocalGraph:async function(e,t,n,o){return r(a("/api/graph/getLocalGraph",{id:t,k:e,conf:n,reqId:o}))},getGraph:async function(e,t,n){return r(a("/api/graph/getGraph",{k:e,conf:t,reqId:n}))}};var S={createNotebook:async function(e){return r(a("/api/notebook/createNotebook",{name:e}))},removeNotebook:async function(e){return r(a("/api/notebook/removeNotebook",{notebook:e}))},setNotebookConf:async function(e){return r(a("/api/notebook/setNotebookConf",{notebook:e}))},getNotebookConf:async function(e){return r(a("/api/notebook/getNotebookConf",{notebook:e}))},openNotebook:async function(e){return r(a("/api/notebook/openNotebook",{notebook:e}))},closeNotebook:async function(e){return r(a("/api/notebook/closeNotebook",{notebook:e}))},renameNotebook:async function(e,t){return r(a("/api/notebook/renameNotebook",{notebook:e,name:t}))}};var B={pushMsg:async function(e=null,t=null,n=7e3){const o={msg:e?e[T]||e.other:t,timeout:n};return r(a("/api/notification/pushMsg",o))},pushErrMsg:async function(e=null,t=null,n=7e3){const o={msg:e?e[T]||e.other:t,timeout:n};return r(a("/api/notification/pushErrMsg",o))}};const T=window.theme.languageMode;var D={getDocOutline:async function(e){return r(a("/api/outline/getDocOutline",{id:e}))}};var _={getBacklink:async function(e){return r(a("/api/ref/getBacklink",{id:e,beforeLen:10,k:"",mk:""}))}};var O={searchEmbedBlock:async function(e,t){return r(a("/api/search/searchEmbedBlock",{stmt:t,excludeIDs:e}))},searchBlock:async function(e){return r(a("/api/search/searchBlock",{query:e}))},searchTemplate:async function(e){return r(a("/api/search/searchTemplate",{k:e}))}};var N={getTag:async function(){return r(a("/api/tag/getTag",{}))}};var L={docSaveAsTemplate:async function(e,t=!1){return r(a("/api/template/docSaveAsTemplate",{id:e,overwrite:t}))},render:async function(e){return r(a("/api/template/render",e))}};var E=Object.freeze({__proto__:null,Account:{},Asset:{},Attr:s,Av:{},Bazaar:{},Block:l,Bookmark:{},Export:u,Filetree:v,Format:{},Graph:w,History:{},Import:{},Inbox:{},Lute:{},Notebook:S,Notification:B,Outline:D,Query:i,Ref:_,Repo:{},Riff:{},Search:O,Setting:{},Snippet:{},Storage:{},Sync:{},System:{},Tag:N,Template:L,_File:b});e.siyuan=E,e.sofill=o}));
